(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-inside-machine-checkApply"],{"0886":function(t,e,i){"use strict";var a=i("a2ea"),n=i.n(a);n.a},"408b":function(t,e,i){"use strict";i.r(e);var a=i("50fe"),n=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=n.a},"50fe":function(t,e,i){"use strict";var a=i("4ea4");i("a15b"),i("d81d"),i("a434"),i("b680"),i("ac1f"),i("1276"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i("5530")),o=(a(i("e143")),a(i("c49e"))),s=a(i("1f79")),u=(a(i("5ff6")),a(i("bb99"))),l=a(i("6820")),c=a(i("96c4")),r=i("2f62"),v={data:function(){return{code:"",itemId:"",itemName:"",dutyIndex:0,startDate:"请选择开工日期",machineTypeIndex:0,machineModel:"",remark:"",workContent:[],number:"",actualNumber:"",timeList:[],price:"",total:"",totalHours:"",hourPrice:"",hourTotalPrice:"",checkContent:""}},computed:(0,n.default)({},(0,r.mapState)(["projectMsg","machineTypes","dutyTypes"])),components:{showToast:o.default,ContentBox:l.default,TimeList:c.default},onLoad:function(t){this.itemName=this.projectMsg.projectName,this.code=t.code,console.log(t.code),this.getMachineWorkingByCode(this.code)},onShow:function(){var t=getCurrentPages(),e=t[t.length-1],i=e.data;i&&(this.workContent=i)},methods:{getMachineWorkingByCode:function(t){var e=this;s.default.getMachineWorkingByCode(t,{},(function(t){if(console.log("获取机械工时详情: ",t),200===t.data.code){var i=t.data.data;e.itemId=i.id,e.timeList=i.machineWorkingHoursTimeVos;var a=0;e.timeList.map((function(t){a+=1*e.calHours(t.startTime,t.completeTime)})),e.totalHours=a,e.dutyIndex=1*i.schedule,e.machineTypes.map((function(t,a){t.type===i.machineType&&(e.machineTypeIndex=a)})),e.machineModel=i.machineModel,e.workContent=i.jobContent.split(","),e.number=i.number,e.actualNumber=i.actualNumber,e.price=i.price,e.total=i.total,e.totalHours=i.totalHours,e.hourPrice=i.hoursPrice,e.hourTotalPrice=i.hoursTotal,e.remark=i.remark}}))},changeDuty:function(t){console.log(t.detail),this.dutyIndex=t.detail.value},changeStartDate:function(t){this.startDate=t.detail.value},changeStartTime:function(t,e){this.timeList[e].actualStartTime=t.detail.value,this.timeList[e].hours=this.calHours(this.timeList[e].actualStartTime,this.timeList[e].actualCompleteTime);var i=0;this.timeList.map((function(t){t.hours&&(i+=1*t.hours)})),this.totalHours=1*i.toFixed(1),this.hourTotalPrice=1*(this.hourPrice*this.totalHours).toFixed(2)},changeEndTime:function(t,e){this.timeList[e].actualCompleteTime=t.detail.value,this.timeList[e].hours=this.calHours(this.timeList[e].actualStartTime,this.timeList[e].actualCompleteTime);var i=0;this.timeList.map((function(t){t.hours&&(i+=1*t.hours)})),this.totalHours=1*i.toFixed(1),this.hourTotalPrice=1*(this.hourPrice*this.totalHours).toFixed(2)},calHours:function(t,e){if(t&&e){var i=t.split(":"),a=e.split(":");1*a[0]<1*i[0]&&(a[0]=1*a[0]+24);var n=60*a[0]+1*a[1]-(60*i[0]+1*i[1]);return(n/60).toFixed(1)}},changeMachineType:function(t){this.machineTypeIndex=t.detail.value},numberInput:function(t){var e=this;this.$nextTick((function(){var i=t.detail.value;e.actualNumber=u.default.numberFilter(i),e.price&&(e.total=1*(e.price*e.actualNumber).toFixed(2))}))},priceInput:function(t){var e=this;this.$nextTick((function(){var i=t.detail.value;e.price=u.default.priceFilter(i),e.actualNumber&&(e.total=1*(e.price*e.actualNumber).toFixed(2))}))},totalInput:function(t){var e=this;this.$nextTick((function(){var i=t.detail.value;e.total=u.default.priceFilter(i)}))},totalFocus:function(){this.total=""},hourPriceInput:function(t){var e=this;this.$nextTick((function(){var i=t.detail.value;e.hourPrice=u.default.priceFilter(i),e.totalHours&&(e.hourTotalPrice=1*(e.hourPrice*e.totalHours).toFixed(2))}))},hourTotalPriceInput:function(t){var e=this;this.$nextTick((function(){var i=t.detail.value;e.hourTotalPrice=u.default.priceFilter(i)}))},hourTotalPriceFocus:function(){this.hourTotalPrice=""},chooseWorkContent:function(){var t=this.workContent;uni.navigateTo({url:"../../outside/workContent?originList="+JSON.stringify(t)})},removeWorkContent:function(t){var e=this;this.workContent.map((function(i,a){i===t&&e.workContent.splice(a,1)}))},applySubmit:function(t){if(""!==this.machineModel)if(0!==this.workContent.length){if(this.timeList.length>0){var e=!0;if(this.timeList.map((function(t,i){t.actualStartTime&&t.actualCompleteTime||(e=!1)})),!e)return void uni.showToast({title:"请补充实际台班时段",icon:"none",duration:1500});if(!this.hourPrice)return void uni.showToast({title:"请输入工时单价",icon:"none",duration:1500});if(!this.hourTotalPrice)return void uni.showToast({title:"请输入工时总价",icon:"none",duration:1500});console.log(this.hourPrice,this.hourTotalPrice)}if(this.number){if(!this.actualNumber)return void uni.showToast({title:"请输入实际车次",icon:"none",duration:1500});if(""===this.price)return void uni.showToast({title:"请输入车次单价",icon:"none",duration:1500});if(""===this.total)return void uni.showToast({title:"请输入车次总价",icon:"none",duration:1500})}var i={id:this.itemId,saveType:t,machineModel:this.machineModel,machineType:this.machineTypes[this.machineTypeIndex].type,projectCode:this.projectMsg.projectCode,machineWorkingHoursTimeUpdateBos:this.timeList,schedule:this.dutyIndex,actualNumber:this.actualNumber,jobContent:this.workContent.join(","),price:1*this.price,total:1*this.total,totalHours:this.totalHours,hoursPrice:1*this.hourPrice,hoursTotal:1*this.hourTotalPrice,remark:this.remark};console.log(i),this.checkContent=0===t?"暂存成功":"操作成功",this.updateMachineReq(i)}else uni.showToast({title:"请选择工作内容",icon:"none",duration:1500});else uni.showToast({title:"请输入机械型号",icon:"none",duration:1500})},updateMachineReq:function(t){var e=this;s.default.updateMachineWorking(t,(function(t){console.log("负责人审核工时: ",t);var i=e;200===t.data.code&&uni.showModal({title:"提示",content:i.checkContent,showCancel:!1,success:function(t){t.confirm&&uni.navigateBack({delta:1})}})}))},addMachineReq:function(t){},editMachineReq:function(t){}}};e.default=v},"98d6":function(t,e,i){var a=i("24fb"),n=i("1de5"),o=i("8e27");e=a(!1);var s=n(o);e.push([t.i,".content[data-v-bd02e4ac]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:%?20?% %?30?% %?140?%;height:100%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column}.main[data-v-bd02e4ac]{-webkit-box-flex:1;-webkit-flex-grow:1;flex-grow:1;overflow-y:auto}.item-box1 uni-view[data-v-bd02e4ac]{-webkit-box-flex:0;-webkit-flex-grow:0;flex-grow:0}.my-input[data-v-bd02e4ac]{text-align:right;font-size:%?28?%;padding-left:%?20?%;-webkit-box-flex:1;-webkit-flex-grow:1;flex-grow:1}.title1[data-v-bd02e4ac]{font-size:%?32?%;color:#333;font-weight:700}.title2[data-v-bd02e4ac]{font-size:%?28?%;color:#333;font-weight:700}.arrow[data-v-bd02e4ac]{padding-right:%?30?%;background:url("+s+") no-repeat;background-size:%?15?% %?24?%;background-position:100%}",""]),t.exports=e},a2ea:function(t,e,i){var a=i("98d6");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("4f06").default;n("931a3c6a",a,!0,{sourceMap:!1,shadowMode:!1})},beb5:function(t,e,i){"use strict";var a;i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return a}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"content"},[i("showToast",{ref:"toast"}),i("v-uni-view",{staticClass:"item-box1"},[i("v-uni-view",{staticClass:"title1"},[t._v("项目工地")]),i("v-uni-input",{staticClass:"my-input",attrs:{placeholder:"请输入项目工地",type:"text",value:t.itemName,disabled:!0}})],1),i("v-uni-view",{staticClass:"main"},[i("v-uni-view",{staticClass:"item-box2"},[i("v-uni-view",{staticClass:"item-line"},[i("v-uni-view",{staticClass:"title1"},[t._v("班次"),i("span",[t._v("*")])]),i("v-uni-picker",{attrs:{mode:"selector",range:t.dutyTypes,"range-key":"name",value:t.dutyIndex},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.changeDuty.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"picker-btn"},[t._v(t._s(t.dutyTypes[t.dutyIndex].name))])],1)],1),i("v-uni-view",{staticClass:"item-line"},[i("v-uni-view",{staticClass:"title1"},[t._v("机械类型"),i("span",[t._v("*")])]),i("v-uni-picker",{attrs:{mode:"selector",range:t.machineTypes,"range-key":"name",value:t.machineTypeIndex},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.changeMachineType.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"picker-btn"},[t._v(t._s(t.machineTypes[t.machineTypeIndex].name))])],1)],1),i("v-uni-view",{staticClass:"item-line"},[i("v-uni-view",{staticClass:"title1"},[t._v("机械型号"),i("span",[t._v("*")])]),i("v-uni-input",{staticClass:"my-input",attrs:{placeholder:"请输入型号",type:"text"},model:{value:t.machineModel,callback:function(e){t.machineModel=e},expression:"machineModel"}})],1)],1),i("v-uni-view",{staticClass:"item-box2"},[i("v-uni-view",{staticClass:"item-line item-line-add"},[i("v-uni-view",{staticClass:"title1"},[t._v("工作内容"),i("span",[t._v("*")])]),i("v-uni-view",{staticClass:"arrow",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.chooseWorkContent.apply(void 0,arguments)}}},[t._v("请选择")])],1),i("Content-Box",{attrs:{param:t.workContent},on:{removeWorkContent:function(e){arguments[0]=e=t.$handleEvent(e),t.removeWorkContent.apply(void 0,arguments)}}})],1),t.number?i("v-uni-view",{staticClass:"item-box2"},[i("v-uni-view",{staticClass:"item-line item-line-add"},[i("v-uni-view",{staticClass:"title1"},[t._v("车次")]),i("v-uni-view",{staticClass:"title2"},[t._v(t._s(t.number||0)+"车")])],1),i("v-uni-view",{staticClass:"item-line"},[i("v-uni-view",{staticClass:"title1"},[t._v("实际用车")]),i("v-uni-input",{staticClass:"my-input",attrs:{placeholder:"请输入实际用车数量",maxlength:"8",type:"number",value:t.actualNumber},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.numberInput.apply(void 0,arguments)}},model:{value:t.actualNumber,callback:function(e){t.actualNumber=e},expression:"actualNumber"}})],1),i("v-uni-view",{staticClass:"item-line"},[i("v-uni-view",{staticClass:"title1"},[t._v("单价")]),i("v-uni-input",{staticClass:"my-input",attrs:{placeholder:"请输入单价",maxlength:"16",type:"number",value:t.price},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.priceInput.apply(void 0,arguments)}},model:{value:t.price,callback:function(e){t.price=e},expression:"price"}})],1),i("v-uni-view",{staticClass:"item-line"},[i("v-uni-view",{staticClass:"title1"},[t._v("总价")]),i("v-uni-input",{staticClass:"my-input",attrs:{placeholder:"请输入总价",maxlength:"16",value:t.total,type:"number"},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.totalInput.apply(void 0,arguments)},focus:function(e){arguments[0]=e=t.$handleEvent(e),t.totalFocus.apply(void 0,arguments)}},model:{value:t.total,callback:function(e){t.total=e},expression:"total"}})],1)],1):t._e(),t._l(t.timeList,(function(e,a){return[t.timeList.length>0?i("v-uni-view",{key:a+"_0",staticClass:"item-box2 time-list-box"},[i("v-uni-view",{staticClass:"item-line item-line-add"},[i("v-uni-view",{staticClass:"title1"},[t._v("台班")]),i("v-uni-view",{staticClass:"title2"},[t._v(t._s(e.startTime||"-")+"至"+t._s(e.completeTime||"-"))])],1),i("v-uni-view",{staticClass:"item-line"},[i("v-uni-view",{staticClass:"title1"},[t._v("实际开工时间")]),i("v-uni-picker",{attrs:{mode:"time",value:e.actualStartTime},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.changeStartTime(e,a)}}},[i("v-uni-view",{staticClass:"picker-btn"},[t._v(t._s(e.actualStartTime||"请输入实际开工时间"))])],1)],1),i("v-uni-view",{staticClass:"item-line"},[i("v-uni-view",{staticClass:"title1"},[t._v("实际完工时间")]),i("v-uni-picker",{attrs:{mode:"time",value:e.actualCompleteTime},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.changeEndTime(e,a)}}},[i("v-uni-view",{staticClass:"picker-btn"},[t._v(t._s(e.actualCompleteTime||"请输入实际完工时间"))])],1)],1),i("v-uni-view",{staticClass:"item-line"},[i("v-uni-view",{staticClass:"title1"},[t._v("合计工时")]),i("v-uni-input",{staticClass:"my-input",attrs:{placeholder:"请输入合计工时",disabled:!0,maxlength:"8",type:"text"},model:{value:e.hours,callback:function(i){t.$set(e,"hours",i)},expression:"item.hours"}})],1)],1):t._e()]})),t.timeList.length>0?i("v-uni-view",{staticClass:"item-box2"},[i("v-uni-view",{staticClass:"item-line"},[i("v-uni-view",{staticClass:"title1"},[t._v("台班总工时")]),i("v-uni-input",{staticClass:"my-input",attrs:{type:"number",value:t.totalHours,disabled:!0}})],1),i("v-uni-view",{staticClass:"item-line"},[i("v-uni-view",{staticClass:"title1"},[t._v("单价")]),i("v-uni-input",{staticClass:"my-input",attrs:{placeholder:"请输入单价",maxlength:"16",type:"number",value:t.hourPrice},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.hourPriceInput.apply(void 0,arguments)}},model:{value:t.hourPrice,callback:function(e){t.hourPrice=e},expression:"hourPrice"}})],1),i("v-uni-view",{staticClass:"item-line"},[i("v-uni-view",{staticClass:"title1"},[t._v("总价")]),i("v-uni-input",{staticClass:"my-input",attrs:{maxlength:"16",placeholder:"请输入总价",value:t.hourTotalPrice,type:"number"},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.hourTotalPriceInput.apply(void 0,arguments)},focus:function(e){arguments[0]=e=t.$handleEvent(e),t.hourTotalPriceFocus.apply(void 0,arguments)}},model:{value:t.hourTotalPrice,callback:function(e){t.hourTotalPrice=e},expression:"hourTotalPrice"}})],1)],1):t._e(),i("v-uni-view",{staticClass:"item-box3"},[i("v-uni-view",{staticClass:"title1"},[t._v("备注信息")]),i("v-uni-view",{staticClass:"textarea-box"},[i("v-uni-textarea",{staticClass:"remark",attrs:{maxlength:"255",value:t.remark||"-"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1)],1)],2),i("v-uni-view",{staticClass:"btn-box"},[i("v-uni-view",{staticClass:"btn cancel",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.applySubmit(0)}}},[t._v("暂存")]),i("v-uni-view",{staticClass:"btn confirm",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.applySubmit(1)}}},[t._v("确认审核")])],1)],1)},o=[]},f100:function(t,e,i){"use strict";i.r(e);var a=i("beb5"),n=i("408b");for(var o in n)"default"!==o&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("0886");var s,u=i("f0c5"),l=Object(u["a"])(n["default"],a["b"],a["c"],!1,null,"bd02e4ac",null,!1,a["a"],s);e["default"]=l.exports}}]);